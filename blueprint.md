# LitBook Prisma Migration Blueprint

## Overview

This document outlines the plan and progress of migrating the LitBook application from a JSON file-based data storage to a PostgreSQL database using Prisma.

## Implemented Changes

### 1. Database and Prisma Setup

-   **Installed Dependencies:**
    -   `prisma`
    -   `@prisma/client`
    -   `pg`
    -   `bcrypt`
    -   `dotenv-cli`
-   **Initialized Prisma:**
    -   Created `prisma/schema.prisma`.
    -   Created `.env` file for database credentials.
    -   Added `.env` to `.gitignore`.
-   **Defined Prisma Schema:**
    -   Created models for `User`, `Book`, `Chapter`, `CommunityPost`, `Comment`, `Activity`, `Publication`, and `Follow`.
    -   Defined relationships between models.
-   **Ran Initial Migration:**
    -   Successfully ran `prisma migrate dev` to create the database schema.
    -   Generated the Prisma Client.

### 2. API Refactoring

-   **Created Prisma Client:**
    -   Instantiated the Prisma Client in `src/api.ts`.
-   **Implemented Authentication:**
    -   Created `login` and `register` functions in `src/api.ts` using Prisma and `bcrypt`.

### 3. Component Refactoring

-   **`App.tsx`:**
    -   Removed old API calls (`initApi`, `getUserById`).
    -   Removed mock data usage for book details and reader.
-   **`LandingScreen.tsx`:**
    -   Updated the `handleSubmit` function to use the new async `login` and `register` functions.
    -   Updated `User` type import.
-   **`types.ts`:**
    -   Removed interfaces now generated by Prisma.

## Pending Tasks

### 1. API Expansion

-   [ ] Implement the remaining API functions in `src/api.ts` using Prisma:
    -   [ ] `getUserById`
    -   [ ] `getCommentsForPost`
    -   [ ] `addComment`
    -   [ ] `getBooks`
    -   [ ] `getBookById`
    -   [ ] `getCommunityPosts`
    -   [ ] `getActivities`
    -   [ ] `getFollowing`
    -   [ ] `createPublication`

### 2. Component Refactoring

-   [ ] Update all components that still use mock data (`MOCK_BOOKS`, `MOCK_ACTIVITIES`, etc.) to fetch data from the new API.
    -   [ ] `App.tsx` (fetch book for detail and reader screens)
    -   [ ] `BookDetailScreen.tsx`
    -   [ ] `CommunityScreen.tsx`
    -   [ ] `FollowingScreen.tsx`
    -   [ ] `HomeScreen.tsx`
    -   [ ] `HomeScreenRightSidebar.tsx`
    -   [ ] `LibraryScreen.tsx`
    -   [ ] `NewPublicationScreen.tsx`
    -   [ ] `ProfileScreen.tsx`
    -   [ ] `ReaderScreen.tsx`
    -   [ ] `SearchScreen.tsx`
    -   [ ] `CommentsScreen.tsx`

### 3. Data Seeding

-   [ ] Create a script to seed the database with initial data from `db.json` and `data.ts`.

### 4. Cleanup

-   [ ] Remove `db.json` and `data.ts` files.
-   [ ] Remove any remaining mock data from the components.
-   [ ] Remove `localStorage` logic for reading progress and bookmarks and move it to the database.
